<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스터디 소주제 랜덤 배정</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1 { color: #333; text-align: center; font-size: 1.5em; margin-bottom: 30px; }
        h3 { margin: 20px 0 10px; color: #333; }
        .range-inputs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        input[type="number"] {
            width: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .participants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .participant-btn {
            background-color: #f0f0f0;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #ddd;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .participant-btn:hover {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }
        .participant-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #45a049;
        }
        .assign-btn {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
        }
        .assign-btn:hover { background-color: #45a049; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th { background-color: #f2f2f2; }
        tr:nth-child(even) { background-color: #f9f9f9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>컴퓨터 과학책 스터디 소주제 배정</h1>
        
        <form id="assignment-form">
            <div class="range-inputs">
                <input type="number" id="range-start" placeholder="시작 장" min="1" max="16" required>
                <input type="number" id="range-end" placeholder="끝 장" min="1" max="16" required>
            </div>
            
            <h3>참여자 선택</h3>
            <div class="participants-grid" id="participants-grid"></div>
            
            <button type="submit" class="assign-btn">랜덤 배정하기</button>
        </form>
        
        <div id="result"></div>
    </div>

    <script>
    // 목차 데이터
    const tableOfContents = {
      1: [
        "1.1 단언문과 테스트 프레임워크",
        "1.2 첫 번째 테스트",
        "1.3 무엇을 테스트할 것인가?",
        "1.4 실패를 통한 학습",
        "1.5 테스트 작성 요령",
        "1.6 단위 테스트의 한계",
        "1.7 점수로 사용자 실력을 계량화해 랭킹 등 다양한 콘텐츠에 활용한다."
      ],
      2: [
        "2.1 테스트할 가치가 있는 코드",
        "2.2 테스트의 경제성",
        "2.3 테스팅 피라미드",
        "2.4 테스트 항목 선정",
        "2.5 테스트 전략 수립"
      ],
      3: [
        "3.1 테스팅 도구 소개",
        "3.2 제스트 기초",
        "3.3 테스트 러너",
        "3.4 단정문",
        "3.5 테스트 조직화"
      ],
      4: [
        "4.1 함수형 프로그래밍과 순수 함수",
        "4.2 부수 효과와 의존성",
        "4.3 명령형 vs 선언형",
        "4.4 불변성과 테스트 용이성"
      ],
      5: [
        "5.1 격리 프레임워크 정의",
        "5.2 동적으로 가짜 모듈 만들기"
      ],
      6: [
        "6.1 테스트 유지보수",
        "6.2 깨지기 쉬운 테스트",
        "6.3 테스트 코드 품질"
      ],
      7: [
        "7.1 통합 테스트 소개",
        "7.2 통합 테스트 구성 요소",
        "7.3 통합 테스트 전략"
      ],
      8: [
        "8.1 E2E 테스트 정의",
        "8.2 도구 선택",
        "8.3 테스트 시나리오 작성"
      ],
      9: [
        "9.1 지속적 통합(CI) 소개",
        "9.2 테스트 자동화",
        "9.3 배포 파이프라인"
      ],
      10: [
        "10.1 테스트 커버리지 개념",
        "10.2 커버리지 도구",
        "10.3 커버리지 기준"
      ],
      11: [
        "11.1 테스트 조직 문화",
        "11.2 테스트 리뷰",
        "11.3 테스트 교육"
      ],
      12: [
        "12.1 테스트와 품질 보증(QA)",
        "12.2 QA 역할 변화",
        "12.3 협업 전략"
      ],
      A: [
        "A.1 Jest 설정",
        "A.2 환경 구성",
        "A.3 트러블슈팅"
      ],
      B: [
        "B.1 테스트에서의 성능 고려",
        "B.2 병렬 테스트 실행",
        "B.3 캐싱 전략"
      ]
    };

    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('assignment-form');
        const participantsGrid = document.getElementById('participants-grid');
        const resultDiv = document.getElementById('result');
        
        // 기본 참여자 목록
        const defaultParticipants = [
            '도키', '디제로', '란초',
            '륜곰', '이쿠맨'
        ];

        // 선택된 참여자를 저장하는 Set (기본적으로 모두 선택)
        let selectedParticipants = new Set(defaultParticipants);

        // 참여자 버튼 생성
        function createParticipantButtons() {
            participantsGrid.innerHTML = '';
            defaultParticipants.forEach(participant => {
                const btn = document.createElement('button');
                btn.type = 'button'; // form submission 방지
                btn.className = `participant-btn ${selectedParticipants.has(participant) ? 'active' : ''}`;
                btn.textContent = participant;
                btn.onclick = () => toggleParticipant(participant, btn);
                participantsGrid.appendChild(btn);
            });
        }

        // 참여자 토글
        function toggleParticipant(participant, btn) {
            if (selectedParticipants.has(participant)) {
                selectedParticipants.delete(participant);
                btn.classList.remove('active');
            } else {
                selectedParticipants.add(participant);
                btn.classList.add('active');
            }
        }

        // 장 범위에 해당하는 소주제 가져오기
        function getTopicsForRange(start, end) {
            const topics = [];
            for (let chapter = start; chapter <= end; chapter++) {
                if (tableOfContents[chapter]) {
                    const chapterTopics = tableOfContents[chapter].map((topic, index) => ({
                        id: `${chapter}.${index + 1}`,
                        text: topic
                    }));
                    topics.push(...chapterTopics);
                }
            }
            return topics;
        }

        // 랜덤 배정 (여러 주제를 받을 수 있는 사람도 랜덤하게)
        function assignRandomly(people, topics) {
            const shuffledPeople = [...people];
            const shuffledTopics = [...topics];
            const assignments = {};
            
            // 사람과 주제 모두 섞기
            for (let i = shuffledPeople.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledPeople[i], shuffledPeople[j]] = [shuffledPeople[j], shuffledPeople[i]];
            }
            for (let i = shuffledTopics.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledTopics[i], shuffledTopics[j]] = [shuffledTopics[j], shuffledTopics[i]];
            }
            
            // 주제 배정
            shuffledTopics.forEach((topic, index) => {
                const personIndex = index % shuffledPeople.length;
                if (!assignments[topic.id]) {
                    assignments[topic.id] = {
                        topic: topic.text,
                        person: shuffledPeople[personIndex]
                    };
                }
            });
            
            return assignments;
        }

        // 결과 표시
        function displayResult(assignments) {
            resultDiv.innerHTML = '';
            
            // 소주제별 발표자 테이블
            const topicHeader = document.createElement('h3');
            topicHeader.textContent = '소주제별 발표자 배정 결과';
            resultDiv.appendChild(topicHeader);
            
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>번호</th>
                        <th>소주제</th>
                        <th>발표자</th>
                    </tr>
                </thead>
                <tbody></tbody>
            `;
            
            const tbody = table.querySelector('tbody');
            
            Object.entries(assignments)
                .sort((a, b) => {
                    const [aId] = a;
                    const [bId] = b;
                    return aId.localeCompare(bId, undefined, {numeric: true});
                })
                .forEach(([id, {topic, person}]) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${id}</td>
                        <td>${topic}</td>
                        <td>${person}</td>
                    `;
                    tbody.appendChild(row);
                });
            
            resultDiv.appendChild(table);
            
            // 참가자별 배정된 주제
            const personTopics = {};
            Object.values(assignments).forEach(({topic, person}) => {
                if (!personTopics[person]) {
                    personTopics[person] = [];
                }
                personTopics[person].push(topic);
            });
            
            const personHeader = document.createElement('h3');
            personHeader.textContent = '참가자별 배정 주제';
            resultDiv.appendChild(personHeader);
            
            const summaryTable = document.createElement('table');
            summaryTable.innerHTML = `
                <thead>
                    <tr>
                        <th>참가자</th>
                        <th>배정된 주제 수</th>
                        <th>배정된 주제</th>
                    </tr>
                </thead>
                <tbody></tbody>
            `;
            
            const summaryTbody = summaryTable.querySelector('tbody');
            
            Object.entries(personTopics).forEach(([person, topics]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${person}</td>
                    <td>${topics.length}</td>
                    <td>${topics.join('<br>')}</td>
                `;
                summaryTbody.appendChild(row);
            });
            
            resultDiv.appendChild(summaryTable);
        }

        // 폼 제출 이벤트 리스너
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const start = parseInt(document.getElementById('range-start').value);
            const end = parseInt(document.getElementById('range-end').value);
            
            if (!start || !end || start > end || start < 1 || end > 16) {
                alert('올바른 장 범위를 입력해주세요 (1-16)');
                return;
            }

            if (selectedParticipants.size === 0) {
                alert('최소 한 명의 참여자를 선택해주세요.');
                return;
            }

            const topics = getTopicsForRange(start, end);
            if (topics.length === 0) {
                alert('선택된 장 범위에 해당하는 소주제가 없습니다.');
                return;
            }

            try {
                const assignments = assignRandomly(Array.from(selectedParticipants), topics);
                displayResult(assignments);
            } catch (error) {
                console.error('Error during assignment:', error);
                alert('배정 중 오류가 발생했습니다: ' + error.message);
            }
        });

        // 초기 참여자 버튼 생성 실행
        createParticipantButtons();
    });
    </script>
</body>
</html>
